---
title: Allocating game servers and connecting Visual Studio debugging tools
author: v-thopra
description: Describes how to allocate multiplayer game servers and connect Visual Studio debugging tools.
ms.author: v-thopra
ms.date: 08/11/2018
ms.topic: article
ms.prod: playfab
keywords: playfab, social, tournaments, leaderboards, servers, debugging
ms.localizationpriority: medium
---

# Allocating Game servers and connecting Visual Studio debugging tools

## Allocating multiplayer sessions

With **PlayFab Multiplayer Servers 2.0**, you can allocate instances of your multiplayer server **Application** using the **RequestMultiplayerServer API**.

Typically this **API** is called from your own services (perhaps a matchmaking service or lobby service), using a [PlayFab Developer Key configured for the specific title](../../config/gamemanager/getting-playfab-developer-keys.md).

A typical pattern for bringing **Players** together and allocating servers:

1. **Clients** collect network **QoS** information.
2. **Clients** interact with a custom matchmaking service, or assemble via social invitations.
3. A custom matchmaking service allocates a **Session** for the group, using a prioritized list of regions.

**RequestMultiplayerServer** has several key parameters:

- **BuildID** - The specific server build to be allocated.
- **SessionID**- An identifier for the **Session**. This should be generated by the caller. Retries to this **API** for the same logical **Session** should re-use the same identifier. This mitigates the possibility of caller retry behavior creating unnecessary servers.
- **SessionCookie** - Arbitrary data that will be communicated via the **Game Server SDK** to the allocated **Session** at activation. A typical usage of this field is communicating a **Shared Key** that **Game** servers use to authenticate **Clients**. Data must be smaller than *4 kilobytes*.
- **PreferredRegions** - An ordered list of **Regions** used to allocate servers. We recommend using network **QoS** measurements collected from the **Client** devices as the primary factor for ranking regions.

A successful allocation will return the following information:

- The **IPv4** address of the server.
- The **TCP/UDP** port mappings (see [Connecting Clients to game servers](connecting-clients-to-game-servers.md)).
- The **Region** of the server.

## Client allocation

Multiplayer servers are expensive and powerful. By default, you can only request a multiplayer server from your *own* trusted service using a **PlayFab Developer Secret Key**.

However, allocating servers *directly* from **Player** devices can save you the cost of implementing service-to-service calls and be useful in some circumstances.

To enable **Client** allocation:

- Select **Settings** from the menu on the left.
- Select the **API Features** tab.
- Then activate the **Allow Client to start games** option.

![Game Manager - Settings - API Features - Allow Client to start games](media/tutorials/game-manager-settings-api-features-allow-client-to-start-games.png)  

When this setting is activated, you can call **RequestMultiplayerServer** using the **Entity** token for any **Player** associated with the **Title**.

## Debugging a deployed multiplayer server

You may want to remotely debug a **Game** server while it is deployed in **Azure**. With **Visual Studio**, this currently requires you to install and configure the **Visual Studio Remote Debugging** tools in the container.

> [!NOTE]
> The procedure that follows will enable **insecure, unauthenticated debugging**.

The following procedure should *only* be applied to server builds that are for development and testing, and *generally avoided* in a **Player**-facing environment.

1. Get the **VS2017 Remote Debugging** tools:

```cmd
Invoke-WebRequest -OutFile rtools_setup_x64.exe -Uri 
https://aka.ms/vs/15/release/RemoteTools.amd64ret.enu.exe
```

2. Include these tools in your **Game** server asset package.
3. As part of creating your server build in **Game Manager** or with the **Entity API**, configure **port 4022 TCP** as a debug port.
4. You will need to run **msvsmon** within the container to enable remote debugging. A common pattern is to specify a **CMD** script as the **Game Start** command, and to use a command-line argument to launch **msvsmon** in addition to your **Game** server executable.
5. Execute **msvsmon** once with:

```cmd    
/prepcomputer
```

6. Execute **msvsmon** with flags:

```cmd    
/nostatus /noauth /nosecuritywarn /anyuser /nofirewallwarn /nodiscovery /port 4022
```

> [!NOTE]
> We recommend *specifically listing* the port so your program can handle the process exit code if the port is already in use, rather than binding to a random port which isnâ€™t open.
7. Allocate your **Game** server.
8. Attempt to debug via **VS** using the external debug port returned from the allocate call.
